{{define "content"}}
{{/* Per AI.md PART 13: Health Check HTML Response */}}
<main class="health-status">
    {{/* Project Info */}}
    <header class="health-header">
        <h1>ğŸ“¦ {{.Config.Server.Title}}</h1>
        <p class="project-description">{{.Config.Server.Description}}</p>
    </header>

    <h2>ğŸ¥ System Health</h2>

    {{/* Status Banner */}}
    {{if eq .Health.Status "healthy"}}
    <div class="status-banner status-healthy">
        <span class="status-icon">âœ…</span>
        <span class="status-text">All Systems Operational</span>
    </div>
    {{else if eq .Health.Status "degraded"}}
    <div class="status-banner status-degraded">
        <span class="status-icon">âš ï¸</span>
        <span class="status-text">Degraded Performance</span>
    </div>
    {{else}}
    <div class="status-banner status-unhealthy">
        <span class="status-icon">ğŸ”´</span>
        <span class="status-text">System Unhealthy</span>
    </div>
    {{end}}

    {{/* Version & Build Info */}}
    <section class="health-section">
        <h2>â„¹ï¸ Version</h2>
        <dl class="info-grid">
            <dt>ğŸ·ï¸ Version</dt><dd>{{version}}</dd>
            <dt>ğŸ¹ Go Version</dt><dd>{{.Health.GoVersion}}</dd>
            {{if .Health.Build}}
            <dt>ğŸ”¨ Build</dt><dd>{{.Health.Build.Commit}} ({{.Health.Build.Date}})</dd>
            {{end}}
            <dt>â±ï¸ Uptime</dt><dd>{{.Health.Uptime}}</dd>
            <dt>ğŸš€ Mode</dt>
            <dd>
                {{if eq .Health.Mode "production"}}
                <span class="badge badge-production">Production</span>
                {{else}}
                <span class="badge badge-development">Development</span>
                {{end}}
            </dd>
        </dl>
    </section>

    {{/* Cluster Info (if enabled) */}}
    {{if .Health.Cluster}}
    {{if .Health.Cluster.Enabled}}
    <section class="health-section">
        <h2>ğŸ”— Cluster</h2>
        <dl class="info-grid">
            <dt>Status</dt>
            <dd>
                {{if eq .Health.Cluster.Status "connected"}}
                <span class="status-ok">âœ… Connected</span>
                {{else}}
                <span class="status-error">âŒ Disconnected</span>
                {{end}}
            </dd>
            {{if .Health.Cluster.Primary}}
            <dt>ğŸ‘‘ Primary</dt><dd><code>{{.Health.Cluster.Primary}}</code></dd>
            {{end}}
            <dt>ğŸ­ Role</dt><dd>{{.Health.Cluster.Role}}</dd>
        </dl>
        {{if .Health.Cluster.Nodes}}
        <h3>ğŸ–¥ï¸ Nodes</h3>
        <ul class="node-list">
            {{range .Health.Cluster.Nodes}}
            <li><code>{{.}}</code> âœ…</li>
            {{end}}
        </ul>
        {{end}}
    </section>
    {{end}}
    {{end}}

    {{/* Features */}}
    <section class="health-section">
        <h2>ğŸ›ï¸ Features</h2>
        <ul class="feature-list">
            {{if .Health.Features.MultiUser}}
            <li class="feature-enabled">ğŸ‘¥ Multi-User</li>
            {{end}}
            {{if .Health.Features.Organizations}}
            <li class="feature-enabled">ğŸ¢ Organizations</li>
            {{end}}
            {{if .Health.Features.Tor}}
            {{if .Health.Features.Tor.Enabled}}
            <li class="feature-enabled">ğŸ§… Tor:
                {{if .Health.Features.Tor.Running}}
                <span class="status-ok">âœ… healthy</span>
                {{if .Health.Features.Tor.Hostname}}
                <code>{{.Health.Features.Tor.Hostname}}</code>
                {{end}}
                {{else}}
                <span class="status-error">âŒ stopped</span>
                {{end}}
            </li>
            {{end}}
            {{end}}
            {{if .Health.Features.GeoIP}}
            <li class="feature-enabled">ğŸŒ GeoIP</li>
            {{end}}
            {{if .Health.Features.Metrics}}
            <li class="feature-enabled">ğŸ“Š Metrics</li>
            {{end}}
        </ul>
    </section>

    {{/* Component Checks */}}
    {{if .Health.Checks}}
    <section class="health-section">
        <h2>ğŸ”§ Component Status</h2>
        <table class="checks-table">
            <thead><tr><th>Component</th><th>Status</th></tr></thead>
            <tbody>
                {{range $service, $status := .Health.Checks}}
                <tr>
                    <td>
                        {{if eq $service "database"}}ğŸ—„ï¸ Database
                        {{else if eq $service "cache"}}ğŸ’¾ Cache
                        {{else if eq $service "disk"}}ğŸ’¿ Disk
                        {{else if eq $service "scheduler"}}â° Scheduler
                        {{else if eq $service "cluster"}}ğŸ”— Cluster
                        {{else}}{{$service}}
                        {{end}}
                    </td>
                    <td class="{{if eq $status "ok"}}status-ok{{else}}status-error{{end}}">
                        {{if eq $status "ok"}}âœ… OK{{else}}âŒ Error{{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </section>
    {{end}}

    {{/* Statistics */}}
    {{if .Health.Stats}}
    <section class="health-section">
        <h2>ğŸ“ˆ Statistics</h2>
        <dl class="info-grid stats-grid">
            <dt>ğŸ“¥ Total Requests</dt><dd>{{.Health.Stats.RequestsTotal}}</dd>
            <dt>ğŸ“… Requests (24h)</dt><dd>{{.Health.Stats.Requests24h}}</dd>
            <dt>ğŸ”Œ Active Connections</dt><dd>{{.Health.Stats.ActiveConnections}}</dd>
        </dl>
    </section>
    {{end}}

    {{/* Footer */}}
    <footer class="health-footer">
        <p>ğŸ• Last checked: <time datetime="{{.Health.Timestamp}}">{{.Health.Timestamp}}</time></p>
        <p class="auto-refresh">Auto-refreshing in <span id="countdown">30</span>s</p>
    </footer>
</main>

<script>
// Auto-refresh countdown
(function() {
    let seconds = 30;
    const countdown = document.getElementById('countdown');
    if (!countdown) return;

    const timer = setInterval(function() {
        seconds--;
        countdown.textContent = seconds;
        if (seconds <= 0) {
            clearInterval(timer);
            window.location.reload();
        }
    }, 1000);
})();
</script>
{{end}}
