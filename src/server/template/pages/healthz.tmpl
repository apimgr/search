{{define "content"}}
{{/* Per AI.md PART 13: Health Check HTML Response */}}
<div class="health-page">
    {{/* Project Header - per AI.md PART 13 */}}
    <header class="health-header">
        {{if .Health.Project}}
        <h1>üì¶ {{.Health.Project.Name}}</h1>
        {{if .Health.Project.Tagline}}
        <p class="tagline">{{.Health.Project.Tagline}}</p>
        {{end}}
        <p class="description">{{.Health.Project.Description}}</p>
        {{else}}
        <h1>üì¶ {{.Config.Server.Title}}</h1>
        <p class="description">{{.Config.Server.Description}}</p>
        {{end}}
    </header>

    {{/* Status Banner - per AI.md PART 13 */}}
    <div class="status-banner {{if eq .Health.Status "healthy"}}status-ok{{else if eq .Health.Status "degraded"}}status-warning{{else}}status-error{{end}}">
        {{if eq .Health.Status "healthy"}}
        <span class="status-icon">‚úÖ</span>
        <span class="status-text">All Systems Operational</span>
        {{else if eq .Health.Status "degraded"}}
        <span class="status-icon">‚ö†Ô∏è</span>
        <span class="status-text">Degraded Performance</span>
        {{else}}
        <span class="status-icon">‚ùå</span>
        <span class="status-text">System Unhealthy</span>
        {{end}}
    </div>

    <div class="health-grid">
        {{/* Version & Build per AI.md PART 13 */}}
        <section class="section-card">
            <h2>‚ÑπÔ∏è Version</h2>
            <dl class="health-info">
                <div class="info-row">
                    <dt>Version</dt>
                    <dd><code>{{version}}</code></dd>
                </div>
                <div class="info-row">
                    <dt>Go Version</dt>
                    <dd><code>{{.Health.GoVersion}}</code></dd>
                </div>
                {{if .Health.Build}}
                <div class="info-row">
                    <dt>Commit</dt>
                    <dd><code>{{.Health.Build.Commit}}</code></dd>
                </div>
                <div class="info-row">
                    <dt>Build Date</dt>
                    <dd>{{.Health.Build.Date}}</dd>
                </div>
                {{end}}
            </dl>
        </section>

        {{/* Runtime per AI.md PART 13 */}}
        <section class="section-card">
            <h2>‚è±Ô∏è Runtime</h2>
            <dl class="health-info">
                <div class="info-row">
                    <dt>Uptime</dt>
                    <dd>{{.Health.Uptime}}</dd>
                </div>
                <div class="info-row">
                    <dt>Mode</dt>
                    <dd>
                        {{if eq .Health.Mode "production"}}
                        <span class="badge badge-production">Production</span>
                        {{else}}
                        <span class="badge badge-development">Development</span>
                        {{end}}
                    </dd>
                </div>
                <div class="info-row">
                    <dt>Last Check</dt>
                    <dd><time datetime="{{.Health.Timestamp}}">{{.Health.Timestamp}}</time></dd>
                </div>
            </dl>
        </section>

        {{/* Component Status per AI.md PART 13 */}}
        {{if .Health.Checks}}
        <section class="section-card">
            <h2>üîß Component Status</h2>
            <ul class="component-list">
                {{range $name, $status := .Health.Checks}}
                <li class="component-item {{if eq $status "ok"}}component-ok{{else}}component-error{{end}}">
                    <span class="component-icon">{{if eq $status "ok"}}‚úì{{else}}‚úï{{end}}</span>
                    <span class="component-name">
                        {{if eq $name "database"}}Database
                        {{else if eq $name "cache"}}Cache
                        {{else if eq $name "disk"}}Disk Space
                        {{else if eq $name "scheduler"}}Scheduler
                        {{else if eq $name "cluster"}}Cluster
                        {{else if eq $name "tor"}}Tor
                        {{else}}{{$name}}{{end}}
                    </span>
                    <span class="component-status">{{if eq $status "ok"}}Operational{{else}}Error{{end}}</span>
                </li>
                {{end}}
            </ul>
        </section>
        {{end}}

        {{/* Features per AI.md PART 13 */}}
        <section class="section-card">
            <h2>üéõÔ∏è Features</h2>
            <ul class="feature-list">
                {{if .Health.Features.Tor}}
                {{if .Health.Features.Tor.Enabled}}
                <li class="feature-item feature-enabled">
                    <span class="feature-icon">üßÖ</span>
                    <span class="feature-name">Tor Hidden Service</span>
                    {{if .Health.Features.Tor.Running}}
                    <span class="feature-status status-ok">Active</span>
                    {{else}}
                    <span class="feature-status status-warning">Starting</span>
                    {{end}}
                </li>
                {{if .Health.Features.Tor.Hostname}}
                <li class="feature-detail">
                    <div class="code-block">
                        <code class="code-content onion-address">{{.Health.Features.Tor.Hostname}}</code>
                        <button type="button" class="copy-btn" data-copy="{{.Health.Features.Tor.Hostname}}" aria-label="Copy to clipboard">
                            <span class="copy-icon">üìã</span>
                            <span class="copy-text">Copy</span>
                        </button>
                    </div>
                </li>
                {{end}}
                {{end}}
                {{end}}

                {{if .Health.Features.GeoIP}}
                <li class="feature-item feature-enabled">
                    <span class="feature-icon">üåç</span>
                    <span class="feature-name">GeoIP</span>
                    <span class="feature-status status-ok">Enabled</span>
                </li>
                {{end}}

                {{if .Health.Features.MultiUser}}
                <li class="feature-item feature-enabled">
                    <span class="feature-icon">üë•</span>
                    <span class="feature-name">Multi-User</span>
                    <span class="feature-status status-ok">Enabled</span>
                </li>
                {{end}}

                {{if .Health.Features.Organizations}}
                <li class="feature-item feature-enabled">
                    <span class="feature-icon">üè¢</span>
                    <span class="feature-name">Organizations</span>
                    <span class="feature-status status-ok">Enabled</span>
                </li>
                {{end}}

                {{if .Health.Features.Metrics}}
                <li class="feature-item feature-enabled">
                    <span class="feature-icon">üìä</span>
                    <span class="feature-name">Metrics</span>
                    <span class="feature-status status-ok">Enabled</span>
                </li>
                {{end}}
            </ul>
        </section>

        {{/* Cluster Info per AI.md PART 13 */}}
        {{if .Health.Cluster}}
        {{if .Health.Cluster.Enabled}}
        <section class="section-card">
            <h2>üîó Cluster</h2>
            <dl class="health-info">
                <div class="info-row">
                    <dt>Status</dt>
                    <dd>
                        {{if eq .Health.Cluster.Status "connected"}}
                        <span class="badge badge-success">Connected</span>
                        {{else}}
                        <span class="badge badge-error">Disconnected</span>
                        {{end}}
                    </dd>
                </div>
                <div class="info-row">
                    <dt>Role</dt>
                    <dd>
                        {{if eq .Health.Cluster.Role "primary"}}
                        <span class="badge badge-primary">Primary</span>
                        {{else}}
                        <span class="badge">Member</span>
                        {{end}}
                    </dd>
                </div>
                {{if .Health.Cluster.Primary}}
                <div class="info-row">
                    <dt>Primary</dt>
                    <dd><code>{{.Health.Cluster.Primary}}</code></dd>
                </div>
                {{end}}
                {{if .Health.Cluster.NodeCount}}
                <div class="info-row">
                    <dt>Nodes</dt>
                    <dd>{{.Health.Cluster.NodeCount}}</dd>
                </div>
                {{end}}
            </dl>
        </section>
        {{end}}
        {{end}}

        {{/* Statistics per AI.md PART 13 */}}
        {{if .Health.Stats}}
        <section class="section-card">
            <h2>üìà Server Statistics</h2>
            <dl class="health-info stats-info">
                <div class="info-row">
                    <dt>Total Requests</dt>
                    <dd>{{.Health.Stats.RequestsTotal}}</dd>
                </div>
                <div class="info-row">
                    <dt>Requests (24h)</dt>
                    <dd>{{.Health.Stats.Requests24h}}</dd>
                </div>
                <div class="info-row">
                    <dt>Active Connections</dt>
                    <dd>{{.Health.Stats.ActiveConnections}}</dd>
                </div>
            </dl>
        </section>
        {{end}}
    </div>

    {{/* Footer */}}
    <footer class="health-footer">
        <p>Last updated: <time datetime="{{.Health.Timestamp}}">{{.Health.Timestamp}}</time></p>
        <p class="auto-refresh">
            <span class="refresh-indicator"></span>
            Auto-refresh in <span id="countdown">30</span>s
        </p>
    </footer>
</div>

<script>
// Auto-refresh countdown - progressively enhanced
(function() {
    var seconds = 30;
    var countdown = document.getElementById('countdown');
    if (!countdown) return;

    var timer = setInterval(function() {
        seconds--;
        countdown.textContent = seconds;
        if (seconds <= 0) {
            clearInterval(timer);
            window.location.reload();
        }
    }, 1000);
})();
</script>
{{end}}
