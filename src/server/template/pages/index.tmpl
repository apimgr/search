{{define "content"}}
<div class="home-container">
    <div class="logo-section">
        {{if .Config.Server.Branding.LogoURL}}
        <img src="{{.Config.Server.Branding.LogoURL}}" alt="{{.Config.Server.Title}}" class="home-logo-img">
        {{else}}
        <h1 class="home-logo">üîç {{default "Search" .Config.Server.Branding.Title}}</h1>
        {{end}}
        <p class="home-tagline">{{.Config.Server.Description}}</p>
    </div>

    <form action="/search" method="GET" class="search-form" id="searchForm">
        <input type="hidden" name="category" id="categoryInput" value="general">
        <div class="search-box">
            <input type="text" name="q" id="searchQuery" placeholder="Search the web privately..." autofocus required autocomplete="off" class="search-input">
            <button type="button" class="advanced-search-trigger" aria-label="Advanced Search" onclick="document.getElementById('advancedSearchModal').showModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="8" r="2"></circle>
                    <path d="M11 10v5"></path>
                    <circle cx="11" cy="19" r="2"></circle>
                    <path d="M11 21v-4"></path>
                    <circle cx="5" cy="14" r="2"></circle>
                    <path d="M5 16v3M5 12V5"></path>
                    <circle cx="17" cy="12" r="2"></circle>
                    <path d="M17 14v5M17 10V5"></path>
                </svg>
            </button>
            <button type="submit" class="search-btn" aria-label="Search">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </button>
        </div>

        <div class="category-tabs" role="tablist">
            <button type="button" class="category-tab active" data-category="general" role="tab" aria-selected="true">
                <span class="tab-icon">üåê</span>
                <span class="tab-text">All</span>
            </button>
            <button type="button" class="category-tab" data-category="images" role="tab" aria-selected="false">
                <span class="tab-icon">üñºÔ∏è</span>
                <span class="tab-text">Images</span>
            </button>
            <button type="button" class="category-tab" data-category="videos" role="tab" aria-selected="false">
                <span class="tab-icon">üé•</span>
                <span class="tab-text">Videos</span>
            </button>
            <button type="button" class="category-tab" data-category="news" role="tab" aria-selected="false">
                <span class="tab-icon">üì∞</span>
                <span class="tab-text">News</span>
            </button>
            <button type="button" class="category-tab" data-category="maps" role="tab" aria-selected="false">
                <span class="tab-icon">üó∫Ô∏è</span>
                <span class="tab-text">Maps</span>
            </button>
        </div>
    </form>

    {{/* Widget Grid Section */}}
    {{if .WidgetsEnabled}}
    <section class="widgets-section">
        <div class="widget-grid" id="widget-grid" data-defaults='{{.DefaultWidgets}}'>
            <!-- Widgets are rendered client-side by widgets.js -->
        </div>
    </section>
    {{end}}

    <div class="home-features">
        <div class="feature">
            <span class="feature-icon">üîí</span>
            <span class="feature-text">No Tracking</span>
        </div>
        <div class="feature">
            <span class="feature-icon">üåê</span>
            <span class="feature-text">Multiple Engines</span>
        </div>
        <div class="feature">
            <span class="feature-icon">üßÖ</span>
            <span class="feature-text">Tor Support</span>
        </div>
    </div>
</div>

{{/* Advanced Search Modal - per AI.md PART 16: Server-side rendering with progressive enhancement */}}
<dialog id="advancedSearchModal" class="advanced-search-modal">
    <header>
        <h2>Advanced Search</h2>
        <button type="button" class="close-btn" onclick="this.closest('dialog').close()" aria-label="Close">&times;</button>
    </header>
    <form action="/search" method="GET" class="advanced-search-content">
        <input type="hidden" name="category" value="general">

        <div class="advanced-search-group">
            <label for="as-allwords">All these words</label>
            <input type="text" id="as-allwords" name="as_allwords" placeholder="Type important words: pizza restaurant">
        </div>

        <div class="advanced-search-group">
            <label for="as-exactphrase">Exact phrase</label>
            <input type="text" id="as-exactphrase" name="as_exactphrase" placeholder="Put exact phrases in quotes: 'best pizza'">
        </div>

        <div class="advanced-search-group">
            <label for="as-anywords">Any of these words</label>
            <input type="text" id="as-anywords" name="as_anywords" placeholder="Type optional words: delivery takeout">
        </div>

        <div class="advanced-search-group">
            <label for="as-nonewords">None of these words</label>
            <input type="text" id="as-nonewords" name="as_nonewords" placeholder="Put a minus before words: -anchovies">
        </div>

        <div class="advanced-search-row">
            <div class="advanced-search-group half">
                <label for="as-site">Site or domain</label>
                <input type="text" id="as-site" name="as_site" placeholder="site:example.com">
            </div>
            <div class="advanced-search-group half">
                <label for="as-filetype">File type</label>
                <select id="as-filetype" name="as_filetype">
                    <option value="">Any format</option>
                    <option value="pdf">PDF</option>
                    <option value="doc">Word (doc/docx)</option>
                    <option value="xls">Excel (xls/xlsx)</option>
                    <option value="ppt">PowerPoint</option>
                    <option value="txt">Plain Text</option>
                </select>
            </div>
        </div>

        <div class="advanced-search-row">
            <div class="advanced-search-group half">
                <label for="as-time">Time range</label>
                <select id="as-time" name="as_time">
                    <option value="">Any time</option>
                    <option value="d">Past 24 hours</option>
                    <option value="w">Past week</option>
                    <option value="m">Past month</option>
                    <option value="y">Past year</option>
                </select>
            </div>
            <div class="advanced-search-group half">
                <label for="as-lang">Language</label>
                <select id="as-lang" name="as_lang">
                    <option value="">Any language</option>
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="zh">Chinese</option>
                    <option value="ja">Japanese</option>
                </select>
            </div>
        </div>

        <div class="advanced-search-preview">
            <label>Search query preview:</label>
            <code id="as-preview">Enter search terms above</code>
        </div>
    </form>
    <footer>
        <button type="button" class="btn btn-secondary" onclick="this.closest('dialog').close()">Cancel</button>
        <button type="submit" form="advancedSearchForm" class="btn btn-primary" onclick="submitAdvancedSearch()">Search</button>
    </footer>
</dialog>
{{end}}

{{define "extra_scripts"}}
<script>
// Category tab switching
document.querySelectorAll('.category-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.category-tab').forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
        });
        this.classList.add('active');
        this.setAttribute('aria-selected', 'true');
        document.getElementById('categoryInput').value = this.dataset.category;
    });
});

// Advanced search functionality
function buildAdvancedQuery() {
    const parts = [];
    const allWords = document.getElementById('as-allwords').value.trim();
    const exactPhrase = document.getElementById('as-exactphrase').value.trim();
    const anyWords = document.getElementById('as-anywords').value.trim();
    const noneWords = document.getElementById('as-nonewords').value.trim();
    const site = document.getElementById('as-site').value.trim();
    const filetype = document.getElementById('as-filetype').value;

    if (allWords) parts.push(allWords);
    if (exactPhrase) parts.push('"' + exactPhrase + '"');
    if (anyWords) parts.push('(' + anyWords.split(/\s+/).join(' OR ') + ')');
    if (noneWords) parts.push(noneWords.split(/\s+/).map(w => '-' + w).join(' '));
    if (site) parts.push('site:' + site);
    if (filetype) parts.push('filetype:' + filetype);

    return parts.join(' ');
}

function updateAdvancedPreview() {
    const query = buildAdvancedQuery();
    document.getElementById('as-preview').textContent = query || 'Enter search terms above';
}

function submitAdvancedSearch() {
    const query = buildAdvancedQuery();
    if (query) {
        document.getElementById('searchQuery').value = query;
        document.getElementById('advancedSearchModal').close();
        document.getElementById('searchForm').submit();
    }
}

// Update preview on input changes
document.querySelectorAll('.advanced-search-content input, .advanced-search-content select').forEach(el => {
    el.addEventListener('input', updateAdvancedPreview);
    el.addEventListener('change', updateAdvancedPreview);
});
</script>
{{end}}
