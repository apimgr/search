{{define "content"}}
<div class="static-page preferences-page">
    <h1>Preferences</h1>
    <p class="subtitle">Customize your search experience. Settings are saved locally in your browser.</p>

    <div class="preferences-section">
        <h2>General Settings</h2>
        <form id="general-settings" class="preferences-form">
            <div class="form-group">
                <label for="theme">Theme</label>
                <select id="theme" name="theme">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="system">System Default</option>
                </select>
            </div>

            <div class="form-group">
                <label for="safe-search">Safe Search</label>
                <select id="safe-search" name="safe_search">
                    <option value="0">Off</option>
                    <option value="1" selected>Moderate</option>
                    <option value="2">Strict</option>
                </select>
            </div>

            <div class="form-group">
                <label for="results-per-page">Results Per Page</label>
                <select id="results-per-page" name="results_per_page">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                </select>
            </div>

            <div class="form-group">
                <label for="new-tab">Open Results in New Tab</label>
                <input type="checkbox" id="new-tab" name="new_tab">
            </div>
        </form>
    </div>

    <div class="preferences-section">
        <h2>Search Bangs</h2>
        <p class="help-text">
            Bangs let you search other sites directly. Type <code>!g</code> before your search to use Google,
            <code>!w</code> for Wikipedia, <code>!yt</code> for YouTube, and many more.
        </p>

        <div class="bang-categories">
            <h3>Available Bangs</h3>
            <div class="category-filter">
                <button class="filter-btn active" data-category="all">All</button>
                {{range .Data.categories}}
                <button class="filter-btn" data-category="{{.}}">{{. | title}}</button>
                {{end}}
            </div>

            <div class="bang-list" id="bang-list">
                {{range .Data.bangs}}
                <div class="bang-item" data-category="{{.Category}}">
                    <span class="bang-shortcut">!{{.Shortcut}}</span>
                    <span class="bang-name">{{.Name}}</span>
                    {{if .Description}}
                    <span class="bang-description">{{.Description}}</span>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>
    </div>

    <div class="preferences-section">
        <h2>Homepage Widgets</h2>
        <p class="help-text">Enable widgets to display on the homepage. These let you access useful information at a glance.</p>

        <div class="widget-toggles" id="widget-toggles">
            <div class="widget-category">
                <h3>Tool Widgets</h3>
                <div class="widget-toggle-group">
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="clock" checked>
                        <span class="widget-icon">üïê</span>
                        <span class="widget-name">Clock</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="calculator">
                        <span class="widget-icon">üî¢</span>
                        <span class="widget-name">Calculator</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="calendar">
                        <span class="widget-icon">üìÖ</span>
                        <span class="widget-name">Calendar</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="converter">
                        <span class="widget-icon">üîÑ</span>
                        <span class="widget-name">Unit Converter</span>
                    </label>
                </div>
            </div>

            <div class="widget-category">
                <h3>Data Widgets</h3>
                <div class="widget-toggle-group">
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="weather">
                        <span class="widget-icon">üå§Ô∏è</span>
                        <span class="widget-name">Weather</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="news">
                        <span class="widget-icon">üì∞</span>
                        <span class="widget-name">News</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="stocks">
                        <span class="widget-icon">üìà</span>
                        <span class="widget-name">Stocks</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="crypto">
                        <span class="widget-icon">üí∞</span>
                        <span class="widget-name">Crypto</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="sports">
                        <span class="widget-icon">‚öΩ</span>
                        <span class="widget-name">Sports</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="rss">
                        <span class="widget-icon">üì°</span>
                        <span class="widget-name">RSS Feeds</span>
                    </label>
                </div>
            </div>

            <div class="widget-category">
                <h3>User Widgets</h3>
                <div class="widget-toggle-group">
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="quicklinks">
                        <span class="widget-icon">üîó</span>
                        <span class="widget-name">Quick Links</span>
                    </label>
                    <label class="widget-toggle">
                        <input type="checkbox" data-widget="notes">
                        <span class="widget-icon">üìù</span>
                        <span class="widget-name">Notes</span>
                    </label>
                </div>
            </div>
        </div>

        <p class="help-text mt-1">
            Tip: You can also configure individual widget settings by clicking the gear icon on each widget on the homepage.
        </p>
    </div>

    <div class="preferences-section">
        <h2>Custom Bangs</h2>
        <p class="help-text">Create your own bang shortcuts. These are saved in your browser.</p>

        <div id="custom-bangs-list" class="custom-bangs-list">
            <!-- Custom bangs will be populated by JavaScript -->
        </div>

        <form id="add-custom-bang" class="add-bang-form">
            <h3>Add Custom Bang</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="bang-shortcut">Shortcut</label>
                    <input type="text" id="bang-shortcut" name="shortcut" placeholder="e.g., mysite" required pattern="[a-zA-Z0-9_-]+">
                </div>
                <div class="form-group">
                    <label for="bang-name">Name</label>
                    <input type="text" id="bang-name" name="name" placeholder="e.g., My Favorite Site" required>
                </div>
            </div>
            <div class="form-group">
                <label for="bang-url">URL Template</label>
                <input type="url" id="bang-url" name="url" placeholder="https://example.com/search?q={query}" required>
                <small>Use <code>{query}</code> as placeholder for the search term</small>
            </div>
            <div class="form-group">
                <label for="bang-category">Category</label>
                <input type="text" id="bang-category" name="category" placeholder="e.g., custom" value="custom">
            </div>
            <button type="submit" class="btn btn-primary">Add Bang</button>
        </form>
    </div>

    <div class="preferences-section">
        <h2>Add to Browser</h2>
        <p class="help-text">Add this search engine to your browser's search bar.</p>

        <div class="browser-add">
            <p>
                Most browsers support adding custom search engines. Look for the search bar settings
                in your browser preferences, or right-click on the search box on the homepage.
            </p>
            <p>
                <strong>OpenSearch URL:</strong>
                <code id="opensearch-url">{{.Config.Server.BaseURL}}/opensearch.xml</code>
            </p>
            <div class="form-group">
                <label for="custom-engine-name">Custom Engine Name (optional)</label>
                <input type="text" id="custom-engine-name" placeholder="{{.Config.Server.Title}}">
                <button type="button" id="copy-opensearch" class="btn btn-secondary">Copy OpenSearch URL</button>
            </div>
        </div>
    </div>

    <div class="preferences-section">
        <h2>Data Management</h2>
        <div class="data-actions">
            <button type="button" id="export-prefs" class="btn btn-secondary">Export Preferences</button>
            <button type="button" id="import-prefs" class="btn btn-secondary">Import Preferences</button>
            <button type="button" id="reset-prefs" class="btn btn-danger">Reset All Preferences</button>
        </div>
        <input type="file" id="import-file" accept=".json" class="hidden">
    </div>

    <div class="preferences-actions">
        <button type="button" id="save-preferences" class="btn btn-primary">Save Preferences</button>
        <span id="save-status" class="save-status"></span>
    </div>
</div>
{{/* Per AI.md PART 16: NO inline CSS/JS - all styles in main.css, scripts in app.js */}}
{{end}}
