{{define "content"}}
<div class="user-page tokens-page">
    <div class="page-header">
        <h1>{{t "user.tokens.title"}}</h1>
        <p class="page-subtitle">Manage your API tokens for programmatic access</p>
    </div>

    <div class="user-container">
        <nav class="user-nav">
            <a href="/users/profile" class="nav-item">{{t "user.profile"}}</a>
            <a href="/users/security" class="nav-item">{{t "user.security"}}</a>
            <a href="/users/tokens" class="nav-item active">{{t "user.tokens"}}</a>
        </nav>

        <div class="user-content">
            {{if .Flash}}
            <div class="alert alert-{{.Flash.Type}}" role="alert">
                {{.Flash.Message}}
            </div>
            {{end}}

            {{if .NewToken}}
            <div class="alert alert-success token-created">
                <h3>{{t "user.tokens.created"}}</h3>
                <div class="token-display">
                    <code id="new-token">{{.NewToken}}</code>
                    <button type="button" class="btn btn-sm btn-secondary" data-action="copy-token">
                        {{t "common.copy"}}
                    </button>
                </div>
                <p class="token-warning">
                    Make sure to copy this token now. You won't be able to see it again!
                </p>
            </div>
            {{end}}

            <div class="tokens-section">
                <div class="section-header">
                    <h2>Your Tokens</h2>
                    <button type="button" class="btn btn-primary btn-sm" id="create-token-btn">
                        {{t "user.tokens.create"}}
                    </button>
                </div>

                {{if .Tokens}}
                <div class="tokens-list">
                    {{range .Tokens}}
                    <div class="token-item">
                        <div class="token-info">
                            <div class="token-name">{{.Name}}</div>
                            <div class="token-prefix">
                                <code>{{.TokenPrefix}}...</code>
                            </div>
                            <div class="token-meta">
                                <span>Created: {{.CreatedAt | formatDate}}</span>
                                {{if .ExpiresAt}}
                                <span>Expires: {{.ExpiresAt | formatDate}}</span>
                                {{else}}
                                <span>{{t "user.tokens.never"}}</span>
                                {{end}}
                                <span>
                                    {{t "user.tokens.last_used"}}:
                                    {{if .LastUsed}}
                                    {{.LastUsed | formatTime}}
                                    {{else}}
                                    {{t "user.tokens.not_used"}}
                                    {{end}}
                                </span>
                            </div>
                            {{if .Permissions}}
                            <div class="token-permissions">
                                {{range .Permissions}}
                                <span class="permission-badge">{{.}}</span>
                                {{end}}
                            </div>
                            {{end}}
                        </div>
                        <form method="POST" action="/users/tokens/revoke" class="token-action" data-confirm-revoke>
                            <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                            <input type="hidden" name="token_id" value="{{.ID}}">
                            <button type="submit" class="btn btn-danger btn-sm">
                                {{t "user.tokens.revoke"}}
                            </button>
                        </form>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="empty-state">
                    <p>You don't have any API tokens yet.</p>
                    <p>API tokens allow you to authenticate with the API programmatically.</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>

    <div class="modal" id="create-token-modal">
        <div class="modal-backdrop" data-action="close-token-modal"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>{{t "user.tokens.create"}}</h3>
                <button type="button" class="modal-close" data-action="close-token-modal">&times;</button>
            </div>
            <form method="POST" action="/users/tokens/create" class="modal-body">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

                <div class="form-group">
                    <label for="token_name">{{t "user.tokens.name"}}</label>
                    <input type="text" id="token_name" name="name" required
                           placeholder="e.g., My API Client" maxlength="64">
                </div>

                <div class="form-group">
                    <label>{{t "user.tokens.permissions"}}</label>
                    <div class="permissions-grid">
                        <label class="permission-toggle">
                            <input type="checkbox" name="permissions" value="read" checked>
                            <span>Read</span>
                        </label>
                        <label class="permission-toggle">
                            <input type="checkbox" name="permissions" value="write">
                            <span>Write</span>
                        </label>
                        <label class="permission-toggle">
                            <input type="checkbox" name="permissions" value="search">
                            <span>Search</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="token_expires">{{t "user.tokens.expires"}}</label>
                    <select id="token_expires" name="expires">
                        <option value="">{{t "user.tokens.never"}}</option>
                        <option value="7">7 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="90">90 days</option>
                        <option value="365">1 year</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-token-modal">
                        {{t "form.cancel"}}
                    </button>
                    <button type="submit" class="btn btn-primary">
                        {{t "user.tokens.create"}}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{{/* Per AI.md PART 16: NO inline CSS/JS - all styles in main.css, scripts in app.js */}}
{{end}}
